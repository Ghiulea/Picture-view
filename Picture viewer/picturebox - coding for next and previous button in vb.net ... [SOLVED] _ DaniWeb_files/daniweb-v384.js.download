var jqxhr;function html_escape(string){return string.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}function tooltips(){$('.tooltip, .popover').remove();if(window.is_desktop){$('[data-toggle="tooltip"]').tooltip({container:'body',boundary:'viewport'});$('[data-toggle="popover"]').popover({container:'body',boundary:'viewport',trigger:'hover focus'})}$(document).on('click',function(){$('.tooltip').remove()})}function check_for_payment(user_id,next_profile=false){$.ajax({type:'POST',url:'/connect/ajax/users/check_payment',data:{user_id:user_id,next_profile:next_profile,csrf_token:csrf_hash},success:function(data){if(data.url){$(location).attr('href',data.url)}},complete:function(){next_check=window.setTimeout(function(){check_for_payment(user_id)},500)}})}function update_notifications(){if($('#js-active-conversations').find('.dz-conversation').length){jqxhr=$.ajax({type:'GET',url:'/connect/ajax/sidebar/notifications',global:false,success:function(data){perform_update_notifications(data)},complete:function(){window.setTimeout(update_notifications,30000)}})}}function update_group_notifications(){if($('#js-active-groups').find('.dz-group').length){jqxhr=$.ajax({type:'GET',url:'/connect/ajax/sidebar/group_notifications',success:function(data){perform_update_group_notifications(data)},complete:function(){window.setTimeout(update_group_notifications,30000)}})}}function tag_suggestions(){var tag_form=$('#js-add-tags');var added_tags=tag_form.find('.js-added-tags');var input=tag_form.find('input[name="tags"]');var suggested_tags=tag_form.find('#js-suggested-tags');var tags=new Array();added_tags.find('a').each(function(index){tags[index]=$(this).text()});jqxhr=$.ajax({type:'GET',url:'/js/community/advanced_tag_suggestions',data:{forum_id:0,query:input.val(),tags:tags,csrf_token:csrf_hash},success:function(data){if(added_tags.find('a').length<5){suggested_tags.html(data).slideDown('fast')}}})}var scroller_ready=true;var sidebar_jqxhr;function perform_sidebar_search(item){var conversations_scroller=$('#js-conversations-scroll');var more_conversations=conversations_scroller.find('#js-more-spinner');var conversations_list=conversations_scroller.find('#js-active-conversations');sidebar_jqxhr=$.ajax({type:'GET',url:'/connect/ajax/sidebar/search',data:{query:item.val(),csrf_token:csrf_hash},beforeSend:function(){if(sidebar_jqxhr!=null){sidebar_jqxhr.abort()}conversations_list.empty();more_conversations.removeClass('d-none')},success:function(data){more_conversations.addClass('d-none js-sidebar-filter');conversations_list.html(data.output);tooltips();gtag('event','Search',{'event_category':'Conversations'})}})}function perform_sidebar_filter(item){var conversations_scroller=$('#js-conversations-scroll');var more_conversations=conversations_scroller.find('#js-more-spinner');var conversations_list=conversations_scroller.find('#js-active-conversations');sidebar_jqxhr=$.ajax({type:'GET',url:'/connect/ajax/sidebar/filter',data:{filter:item.data('filter'),csrf_token:csrf_hash},beforeSend:function(){if(sidebar_jqxhr!=null){sidebar_jqxhr.abort()}conversations_list.empty();more_conversations.removeClass('d-none')},success:function(data){more_conversations.addClass('d-none js-sidebar-filter');conversations_list.html(data.output);tooltips();gtag('event','Filter',{'event_category':'Conversations'})}})}function more_conversations(user_id,items_count){var conversations_container=$('#js-conversations-container');var conversations_scroller=conversations_container.find('#js-conversations-scroll');var scroller_jqxhr;conversations_container.on('ps-y-reach-end',conversations_scroller,function(event){var more_conversations=conversations_scroller.find('#js-more-spinner');var conversations_list=conversations_scroller.find('#js-active-conversations');if(scroller_ready&&!more_conversations.hasClass('js-sidebar-filter')){scroller_jqxhr=$.ajax({type:'GET',url:'/connect/ajax/sidebar/conversations',data:{offset:conversations_list.data('offset'),user_id:user_id,no_wrapper:true,},beforeSend:function(){if(scroller_jqxhr!=null){scroller_jqxhr.abort()}scroller_ready=false;more_conversations.removeClass('d-none')},success:function(data){if(data.more!==false){conversations_list.append(data.output);conversations_scroller.perfectScrollbar('update');tooltips();conversations_list.data('offset',data.offset);scroller_ready=true;gtag('event','Retrieve More',{'event_category':'Conversations'})}else{scroller_ready=false}more_conversations.addClass('d-none')}})}})}function perform_browse(action){var profile_wrapper=$('#js-profile-wrapper');var profile_container=profile_wrapper.find('#js-connect-profile');var meet_buttons=$('#js-meet-buttons');var user_id=$('#js-connect-profile').data('user-id');var body=$('body');if(action=='meet'){body.addClass('be-loading be-loading-active')}else if(action=='skip'){body.addClass('be-loading be-loading-active')}else{body.addClass('be-loading be-loading-active')}$.ajax({type:'POST',url:'/connect/ajax/users/browse',data:{action:action,user_id:user_id,csrf_token:csrf_hash},success:function(data){if(action=='meet'){jqxhr=$.get('/connect/ajax/sidebar/conversations',{no_wrapper:true,},function(data){var conversations_scroller=$('#js-conversations-scroll');$('#js-active-conversations').html(data.output);conversations_scroller.perfectScrollbar('update');tooltips()})}if(data.url){$.get(data.url,function(html){var foo=$('<div/>').html(html);profile_wrapper.html(foo.find('#js-profile-wrapper > *'));meet_buttons.html(foo.find('#js-meet-buttons > *'));$(document).prop('title','Connect with '+data.name+' | DaniWeb Connect');$('#js-orig-page-title').html('Connect with '+data.name);if(history.pushState){history.pushState({match_id:data.id},data.name+' | DaniWeb Connect',data.profile_url)}else{window.location.hash='!'+data.profile_url}gtag('config','UA-98289-1',{'page_path':data.profile_url});tooltips();body.removeClass('be-loading be-loading-active')})}else if(data.output){profile_wrapper.html(data.output);meet_buttons.remove();$(document).prop('title',data.name+' | DaniWeb Connect');$('#js-orig-page-title').html(data.name);if(history.pushState){history.pushState({match_id:data.id},data.name+' | DaniWeb Connect',data.profile_url)}else{window.location.hash='!'+data.profile_url}gtag('config','UA-98289-1',{'page_path':data.profile_url});body.removeClass('be-loading be-loading-active')}gtag('event','Browse',{'event_category':'Profiles','event_label':action})}});$('html, body').animate({scrollTop:0},'slow')}function perform_gritter(data){if(!$('body').hasClass('modal-open')){$.each(data,function(key,item){if(item.conversation.new_message_count>0){if(!$('#js-gritter-'+key).length){$.gritter.add({title:'<a class="js-gritter text-white" data-message-id="'+item.conversation.latest_message_id+'" data-conversation-id="'+key+'" id="js-gritter-'+key+'" href="'+item.conversation.url+'">New Message from '+item.member.username+'</a>',text:item.conversation.latest_message_preview,image:item.member.avatar,class_name:'dark img-rounded dw-clickable-container',sticky:true,after_close:function(){jqxhr=$.ajax({type:'POST',url:'/connect/ajax/sidebar/record_seen',data:{csrf_token:csrf_hash,conversation_id:key,message_id:item.conversation.latest_message_id}});gtag('event','Record Seen',{'event_category':'Conversations'})}})}}})}}function perform_update_group_notifications(data){$.each(data.groups,function(key,item){var group=$('#dz-group-'+key);var badge=group.find('.badge');var latest_message=group.find('.dz-latest-message');var message_preview=group.find('.dz-message-preview');var name=group.find('.js-name');var avatar=group.find('img');if(badge.text()!=item.group.new_message_count){badge.text(item.group.new_message_count);if(item.group.new_message_count==0){badge.addClass('d-none');latest_message.addClass('text-muted').removeClass('text-primary');name.removeClass('text-primary font-weight-bold')}else{badge.removeClass('d-none');latest_message.addClass('text-primary').removeClass('text-muted');name.addClass('text-primary font-weight-bold')}}message_preview.html(item.group.latest_message_preview);latest_message.text(item.group.latest_message_timestamp);avatar.attr('src',item.group.latest_message_user_avatar)});if(window.is_desktop&&data.gritter){perform_gritter(data.gritter)}}function perform_update_notifications(data){$.each(data.conversations,function(key,item){var conversation=$('#dz-conversation-'+key);var badge=conversation.find('.badge');var latest_message=conversation.find('.dz-latest-message');var message_preview=conversation.find('.dz-message-preview');var name=conversation.find('.js-name');if(badge.text()!=item.conversation.new_message_count){badge.text(item.conversation.new_message_count);if(item.conversation.new_message_count==0){badge.addClass('d-none');latest_message.addClass('text-muted').removeClass('text-primary');name.removeClass('text-primary font-weight-bold')}else{badge.removeClass('d-none');latest_message.addClass('text-primary').removeClass('text-muted');name.addClass('text-primary font-weight-bold')}}message_preview.html(item.conversation.latest_message_preview);latest_message.text(item.conversation.latest_message_timestamp);conversation.attr('data-original-title','Active '+item.user.last_activity_timestamp)});if(window.is_desktop&&data.gritter){perform_gritter(data.gritter)}}function perform_navigate_group(next_group){if(next_group.length){var active_groups=$('#js-active-groups');var curr_group=active_groups.find('.active');var url=next_group.find('a').attr('href');var title=next_group.find('.js-name').text();$('#dz-chat-container').load(url+' #dz-chat-container > *',function(){var message_input=$('#js-message-input');var messages_scroller=$('#dz-chat').find('.be-scroller');messages_scroller.perfectScrollbar();messages_scroller.scrollTop(messages_scroller.prop('scrollHeight'));tooltips();message_input.focus()});curr_group.removeClass('active');next_group.addClass('active');var badge=next_group.find('.badge');var latest_message=next_group.find('.dz-latest-message');var name=next_group.find('.js-name');badge.addClass('d-none');latest_message.addClass('text-muted').removeClass('text-primary');name.removeClass('text-primary font-weight-bold');$(document).prop('title',title+' | DaniWeb Connect');$('.dz-page-title #js-page-title').html(title);if(history.pushState){history.pushState({group_id:next_group.data('group-id')},title+' | DaniWeb Connect',url)}else{window.location.hash='!'+url}$('#dz-profile').removeClass('active');gtag('config','UA-98289-1',{'page_title':title+' | DaniWeb Connect','page_path':url})}}function perform_navigate_convo(next_conversation){if(next_conversation.length){var active_conversations=$('#js-active-conversations');var curr_conversation=active_conversations.find('.active');var url=next_conversation.find('a').attr('href');var profile_url=next_conversation.data('url');var avatar=next_conversation.find('img').clone().removeClass('float-left').css({'width':'35px','height':'35px'});var raw_title='Conversation with '+next_conversation.find('.js-name').text();var text_title='<span class="d-none d-sm-inline">Conversation with</span> '+next_conversation.find('.js-name').html();var title='<a href="'+next_conversation.data('url')+'">';var title=title+avatar.get(0).outerHTML;var title=title+'</a>';var title=title+'\n\t'+text_title;$('#dz-chat-container').load(url+' #dz-chat-container > *',function(){var message_input=$('#js-message-input');var messages_scroller=$('#dz-chat').find('.be-scroller');messages_scroller.perfectScrollbar();messages_scroller.scrollTop(messages_scroller.prop('scrollHeight'));tooltips();message_input.focus();if(!(next_conversation.find('.js-name').hasClass('js-deleted-member'))){$('.js-member-stats').attr('href',$('#dz-chat').data('member-stats-url')).removeClass('d-none');$('.js-business-card').attr('href',$('#dz-chat').data('business-card-url')).removeClass('d-none')}});if(next_conversation.find('.js-name').hasClass('js-deleted-member')){$('.js-member-stats, .js-business-card').addClass('d-none');title=text_title}curr_conversation.removeClass('active');next_conversation.addClass('active');var badge=next_conversation.find('.badge');var latest_message=next_conversation.find('.dz-latest-message');var name=next_conversation.find('.js-name');badge.addClass('d-none');latest_message.addClass('text-muted').removeClass('text-primary');name.removeClass('text-primary font-weight-bold');$(document).prop('title',raw_title+' | DaniWeb Connect');$('.dz-page-title #js-page-title').html(title);if(history.pushState){history.pushState({conversation_id:next_conversation.data('conversation-id')},raw_title+' | DaniWeb Connect',url)}else{window.location.hash='!'+url}gtag('config','UA-98289-1',{'page_title':raw_title+' | DaniWeb Connect','page_path':url})}}function perform_last_seen(last_seen){if(last_seen.length){$('.js-last-seen:not(:empty)').empty();$.each(last_seen,function(key,value){var last_seen_container=$('#dz-message-'+key).find('.js-last-seen');last_seen_container.text(value.output)})}}function perform_poll(){var next_poll;var chat_container=$('#dz-chat');var messages_container=$('#js-messages');var messages_scroller=chat_container.find('.be-scroller');var conversation_id=chat_container.data('conversation-id');var group_id=chat_container.data('group-id');var active_conversations=$('#js-active-conversations');var active_groups=$('#js-active-groups');jqxhr=$.ajax({type:'GET',url:'/connect/ajax/messages/poll',data:{conversation_id:conversation_id,group_id:group_id,message_id:messages_container.find('.js-message').filter(':last').data('id')},success:function(data){if(typeof conversation_id!=='undefined'){var conversation=$('#dz-conversation-'+conversation_id)}else if(typeof group_id!=='undefined'){var group=$('#dz-group-'+group_id)}if((typeof conversation_id!=='undefined'&&chat_container.data('conversation-id')==conversation_id)||(typeof group_id!=='undefined'&&chat_container.data('group-id')==group_id)){if(data.html){messages_container.append(data.html);tooltips();messages_scroller.perfectScrollbar('update');messages_scroller.animate({scrollTop:messages_scroller.prop('scrollHeight')});if(typeof conversation_id!=='undefined'){conversation.prependTo(active_conversations);gtag('event','Poll',{'event_category':'Messages','non_interaction':true})}else if(typeof group_id!=='undefined'){group.prependTo(active_groups);gtag('event','Poll',{'event_category':'Group Messages','non_interaction':true})}}if(typeof conversation_id!=='undefined'){perform_last_seen(data.last_seen);perform_update_notifications(data.notifications)}else{perform_update_group_notifications(data.notifications)}if(window.is_desktop&&data.notifications.gritter){perform_gritter(data.notifications.gritter)}}},complete:function(data){if(data.html){next_poll=window.setTimeout(perform_poll,100)}else{next_poll=window.setTimeout(perform_poll,500)}}})}function find_added_tags(form){var added_tags=form.find('.js-added-tags');var tags=new Array();added_tags.find('a').each(function(index){tags.push($(this).text())});return tags}function doc_ready_meet_by_email(){$(document).on('submit','#js-meet-by-email',function(event){event.preventDefault();$.ajax({type:'POST',url:'/connect/ajax/users/profile/'+$(this).closest('#js-connect-profile').data('user-id')+($('#dw-connect').length==0?'/stats':''),data:$(this).serialize(),success:function(output){$('#js-profile-container').html(output);tooltips()}})})}function doc_ready_load_conversations(user_id,auto_update){jqxhr=$.get('/connect/ajax/sidebar/conversations',{user_id:user_id,},function(data){$('#js-conversations').html(data.output);tooltips();if(auto_update){update_notifications()}more_conversations(user_id,50);$(document).on('click','.js-link-jump',function(event){event.preventDefault();event.stopPropagation();window.location.href=$(this).data('href')});$(document).on('click','.js-mute',function(event){event.preventDefault();event.stopPropagation();var conversation=$(this).closest('.dz-conversation');conversation.slideUp(function(){$(this).remove();tooltips()});jqxhr=$.ajax({type:'POST',url:'/connect/ajax/users/block',data:{csrf_token:csrf_hash,user_id:conversation.data('user-id'),}});gtag('event','Mute',{'event_category':'Conversations'})});$(document).on('click','.js-archive',function(event){event.preventDefault();event.stopPropagation();var conversation=$(this).closest('.dz-conversation');conversation.slideUp(function(){$(this).remove();tooltips()});jqxhr=$.ajax({type:'POST',url:'/connect/ajax/sidebar/archive',data:{csrf_token:csrf_hash,conversation_id:conversation.data('conversation-id'),}});gtag('event','Archive',{'event_category':'Conversations'})});var search_form=$('#dz-sidebar-search');var input=search_form.find('#dz-search-input');var filter=$('#js-sidebar-filter').find('a');var sidebar=$('#js-initial-sidebar');var initial_html=sidebar.html();$('#dz-sidebar-search').on('submit',function(event){event.preventDefault();if(input.val().length){perform_sidebar_search(input);scroller_ready=false}else{sidebar.html(initial_html);scroller_ready=true}});filter.on('click',function(event){event.preventDefault();perform_sidebar_filter($(this))});input.on('keyup',function(){if(input.val().length){perform_sidebar_search($(this));scroller_ready=false}else{sidebar.html(initial_html);scroller_ready=true}})})}function doc_ready_load_groups(group_id,auto_update){jqxhr=$.get('/connect/ajax/sidebar/groups',{group_id:group_id,},function(data){$('#js-conversations').html(data.output);tooltips();if(auto_update){update_group_notifications()}$(document).on('click','.js-leave',function(event){event.preventDefault();event.stopPropagation();var group=$(this).closest('.dz-group');group.slideUp(function(){$(this).remove();tooltips()});jqxhr=$.ajax({type:'POST',url:'/connect/ajax/sidebar/leave',data:{csrf_token:csrf_hash,group_id:group.data('group-id'),}});gtag('event','Leave',{'event_category':'Groups'})})})}function doc_ready_conversations(){var messages_scroller=$('#dz-chat').find('.be-scroller');var message_input=$('#js-message-input');var dummy_id=0;var msg_scroller_jqxhr;var msg_scroller_ready=true;messages_scroller.scrollTop(messages_scroller.prop('scrollHeight'));message_input.focus();perform_poll();$('#dz-chat-container').on('ps-y-reach-start',messages_scroller,function(event){var chat_container=$('#dz-chat');var more_messages=chat_container.find('#js-more-spinner');if(more_messages.length){var messages_container=$('#js-messages');var messages_scroller=chat_container.find('.be-scroller');var conversation_id=chat_container.data('conversation-id');var group_id=chat_container.data('group-id');if(msg_scroller_ready){msg_scroller_jqxhr=$.ajax({type:'GET',url:'/connect/ajax/messages/older',data:{conversation_id:conversation_id,group_id:group_id,message_id:messages_container.find('.js-message').filter(':first').data('id')},beforeSend:function(){if(msg_scroller_jqxhr!=null){msg_scroller_jqxhr.abort()}msg_scroller_ready=false;more_messages.removeClass('d-none')},success:function(data){messages_container.prepend(data.output);messages_scroller.perfectScrollbar('update');tooltips();if(!data.more){more_messages.remove()}else{more_messages.addClass('d-none')}msg_scroller_ready=true;gtag('event','Retrieve More',{'event_category':'Messages'})}})}}});$(window).on('keydown',function(event){var message=$('#js-message-input');if(message.val().length){if(event.which==13){event.preventDefault();$('#dz-send-message').submit()}}else{var curr_conversation=$('#js-active-conversations').find('.active');var curr_group=$('#js-active-groups').find('.active');if(curr_conversation.length){if(event.which==40){event.preventDefault();perform_navigate_convo(curr_conversation.next())}else if(event.which==38){event.preventDefault();perform_navigate_convo(curr_conversation.prev())}}else if(curr_group.length){if(event.which==40){event.preventDefault();perform_navigate_group(curr_group.next())}else if(event.which==38){event.preventDefault();perform_navigate_group(curr_group.prev())}}}});$(document).on('submit','#dz-send-message',function(event){event.preventDefault();var form=$(this);var submit=form.find('button[type="submit"]');var message=form.find('#js-message-input');var my_message=message.val();var chat_container=$('#dz-chat');var messages_container=$('#js-messages');var messages_scroller=chat_container.find('.be-scroller');var conversation_id=chat_container.data('conversation-id');var group_id=chat_container.data('group-id');var active_conversations=$('#js-active-conversations');var active_groups=$('#js-active-groups');if(!submit.hasClass('disabled')){submit.addClass('disabled');message.val('').focus();if(my_message.length==0){form.find('.form-control').addClass('form-control-error is-invalid');submit.removeClass('disabled');gtag('event','Send',{'event_category':'Messages','event_label':'Error'})}else{msg_dummy_id=dummy_id;dummy_id++;var msg=$('#js-message-dummy').find('li').clone();msg.find('#js-message-tmp').text(my_message);msg.prop('id','js-message-dummy-'+msg_dummy_id);messages_container.append(msg);messages_scroller.perfectScrollbar('update');messages_scroller.animate({scrollTop:messages_scroller.prop('scrollHeight')});jqxhr=$.ajax({type:'POST',url:'/connect/ajax/messages/post',data:{csrf_token:csrf_hash,conversation_id:conversation_id,group_id:group_id,message:my_message},success:function(data){if(data.output){if(typeof conversation_id!=='undefined'){var conversation=$('#dz-conversation-'+conversation_id)}else if(typeof group_id!=='undefined'){var group=$('#dz-group-'+group_id)}$('#js-message-dummy-'+msg_dummy_id).replaceWith(data.output);messages_scroller.perfectScrollbar('update');messages_scroller.animate({scrollTop:messages_scroller.prop('scrollHeight')});form.find('.form-control').removeClass('form-control-error is-invalid');if(typeof conversation_id!=='undefined'){conversation.prependTo(active_conversations);gtag('event','Send',{'event_category':'Messages'});perform_update_notifications(data.notifications)}else if(typeof group_id!=='undefined'){group.prependTo(active_groups);gtag('event','Send',{'event_category':'Group Messages'});perform_update_group_notifications(data.notifications)}}else if(data.errors){form.find('.form-control').addClass('form-control-error is-invalid');message.val(my_message);gtag('event','Send',{'event_category':'Messages','label':'Error'})}},complete:function(data){submit.removeClass('disabled')}})}}});$(document).on('click','#js-active-conversations a',function(event){event.preventDefault();perform_navigate_convo($(this).closest('li'))});$(document).on('click','#js-active-groups a',function(event){event.preventDefault();perform_navigate_group($(this).closest('li'))});$(document).on('click','.js-delete',function(event){event.preventDefault();var message=$(this).closest('.js-message');var message_id=message.data('id');var conversation_id=$('#dz-chat').data('conversation-id');var group_id=$('#dz-chat').data('group-id');gtag('event','Delete',{'event_category':'Group Messages'});message.slideUp();jqxhr=$.ajax({type:'POST',url:'/connect/ajax/messages/delete',data:{message_id:message_id,csrf_token:csrf_hash}})});$(document).on('click','.js-conversation-mute',function(event){event.preventDefault();event.stopPropagation();var conversation=$('#dz-chat');var undo=$(this).data('undo');var url='/connect/ajax/users/block';if(undo){url='/connect/ajax/users/unblock';$(this).html('<i role="presentation" class="fas fa-user-slash fa-fw"></i>Mute User');$(this).data('undo',false)}else{$(this).html('<i role="presentation" class="fas fa-user-slash fa-fw"></i>Unmute User');$(this).data('undo',true)}jqxhr=$.ajax({type:'POST',url:url,data:{csrf_token:csrf_hash,user_id:conversation.data('user-id'),}});gtag('event','Mute',{'event_category':'Conversations'})})}function doc_ready_tag(){var tag_form=$('#js-add-tags');if(tag_form.length){var input=tag_form.find('input[name="tags"]');var added_tags=tag_form.find('.js-added-tags');var suggested_tags=tag_form.find('#js-suggested-tags');var form=tag_form.closest('form');input.on('focus keyup',function(){tag_suggestions()});input.on('focusout',function(event){suggested_tags.slideUp('fast');var value=$(this).val().trim();if(value.length){jQuery('<a/>',{href:'#',rel:'tag',html:'<i role="presentation" class="fas fa-tag fa-fw"></i>'+html_escape(value),class:'btn btn-secondary btn-dw-selected mr-2',tabindex:'-1',}).appendTo(added_tags)}$(this).val('')});input.on('keydown',function(event){if(event.which==32||event.which==59||event.which==44){event.preventDefault();var value=$(this).val().trim();if(value.length){jQuery('<a/>',{href:'#',rel:'tag',html:'<i role="presentation" class="fas fa-tag fa-fw"></i>'+html_escape(value),class:'btn btn-secondary btn-dw-selected mr-2',tabindex:'-1',}).appendTo(added_tags)}$(this).val('')}else if(event.which==8){if(!$(this).val().length&&added_tags.find('a').length){event.preventDefault();var last_tag=added_tags.find('a').last();$(this).val(last_tag.text());last_tag.remove()}}});suggested_tags.on('mousedown','a',function(event){jQuery('<a/>',{href:'#',rel:'tag',html:'<i role="presentation" class="fas fa-tag fa-fw"></i>'+$(this).text(),class:'btn btn-secondary btn-dw-selected mr-2',tabindex:'-1',}).appendTo(added_tags);input.val('').focus();tag_suggestions();event.preventDefault()});added_tags.on('click','a',function(){$(this).remove();input.val($(this).text()).focus()});if(form.length&&form.attr('id')!='dz-user-filter'){$(document).on('submit',form,function(event){input.addClass('d-none').val(find_added_tags(tag_form).join(','))})}}}function doc_ready_tooltips(){tooltips()}function doc_ready_click(){$(document).on('click','.js-navigate',function(event){event.preventDefault();event.stopPropagation();var url=$(this).data('url');$(location).attr('href',url)})}function doc_ready_select2(){$('.select2').select2({width:'100%',placeholder:{id:0,text:$(this).attr('placeholder')}})}function doc_ready_typeahead(){var username_container=$('#js-username-container');var username_search=username_container.find('.js-username');var usernames=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:'/js/messages/username_suggestions?term=%QUERY',wildcard:'%QUERY',}});username_search.typeahead({minLength:1,highlight:true},{name:'search-usernames',source:usernames,limit:20,});username_container.find('.twitter-typeahead').css('display','block');var container=$('#dw-search-container');var site_search=container.find('#dw-site-search');var tags=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:'/js/community/search_suggestions?term=%QUERY',wildcard:'%QUERY',transform:function(data){return data.tags}}});var articles=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:'/js/community/search_suggestions?term=%QUERY',wildcard:'%QUERY',transform:function(data){return data.articles}}});var members=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:'/js/community/search_suggestions?term=%QUERY',wildcard:'%QUERY',transform:function(data){return data.members}}});var other=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:'/js/community/search_suggestions?term=%QUERY',wildcard:'%QUERY',transform:function(data){return data.other}}});site_search.typeahead({minLength:0,highlight:true},{limit:100,href:'/{{value}}',name:'search-tags',display:'auto',source:tags,templates:{header:'<strong class="d-block pt-1 pb-1 pl-2">Tags</strong>',footer:'<hr class="dropdown-divider" style="clear:left"></hr>',suggestion:function(item){return'<a class="col-lg-6 col-xl-4 float-left" href="'+item.value+'"><span class="badge btn-dw-link"><i role="presentation" class="fas fa-fw fa-'+item.icon+'"></i> '+item.label+'</span></a>'}}},{limit:100,href:'/{{value}}',name:'search-articles',display:'auto',source:articles,templates:{header:'<strong class="d-block pt-1 pb-1 pl-2">Topics</strong>',footer:'<hr class="dropdown-divider"></hr>',suggestion:function(item){return`<a class="pr-5 d-inline-block text-truncate"href="`+item.value+`"><i role="presentation"class="fas fa-fw fa-`+item.icon+`"></i><span class="d-inline-block mr-2">`+item.label+`</span><span class="d-inline-block small text-muted">`+item.preview+`</span></a>`}}},{limit:100,href:'/{{value}}',name:'search-members',display:'auto',source:members,templates:{header:'<strong class="d-block pt-1 pb-1 pl-2">Members</div>',footer:'<hr class="dropdown-divider"></hr>',suggestion:function(item){return`<a href="`+item.value+`"><img class="rounded-circle mr-1"alt="Member Avatar"width="25"height="25"src="`+item.avatar+`"></img><span class="d-inline-block">`+item.username+`</span></a>`}}},{limit:100,href:'/{{value}}',name:'search-other',display:'auto',source:other,templates:{suggestion:function(item){return'<a href="'+item.value+'"><i role="presentation" class="fas fa-fw fa-'+item.icon+'"></i> '+item.label+'</a>'}}}).on('keypress',function(e){if(e.which==13){site_search.closest('form').submit()}});var typeahead=container.find('.twitter-typeahead');typeahead.addClass('input-group input-group-sm').css('display','flex');container.find('.input-group-append').appendTo(typeahead)}function doc_ready_gritter(){$(document).on('click','.gritter-item',function(event){event.preventDefault();event.stopPropagation();var url=$(this).find('a.js-gritter');if(url.length){window.location.href=url.attr('href')}})}function doc_ready_browse(){$(window).on('keydown',function(event){if($('#js-meet-buttons').length){if(event.which==13){event.preventDefault();var pay_to_meet=$('#js-pay-meet');if(pay_to_meet.length){window.location.href=pay_to_meet.attr('href')}else{perform_browse('meet')}}else if(event.which==39){event.preventDefault();perform_browse('skip')}else if(event.which==46){event.preventDefault();perform_browse('mute')}}});$(document).on('click','#js-meet, #js-skip, #js-mute',function(event){event.preventDefault();var action=$(this).data('action');perform_browse(action)})}function doc_ready_sidebar(){$('#dw-sidebar').load('/js/welcome/sidebar .be-left-sidebar > *',function(){var group_id=$(this).data('group-id');var version=$(this).data('version');$.ajax({url:'//cdn.daniweb.com/js/connect/group'+group_id+'-v'+version+'.js',dataType:"script",cache:true})})}function doc_ready_masonry(){var $grid=$('#masonry-grid').masonry({itemSelector:'.grid-item',percentPosition:true,horizontalOrder:false,gutter:0,transitionDuration:0});$grid.imagesLoaded().progress(function(){$grid.masonry('layout')})}function doc_ready_captcha(){$(document).on('submit','form',function(){var id=$(this).attr('id')+'-captcha';if($(this).attr('method')=='post'){if($('#'+id).length==0){var captcha=jQuery('<input/>',{id:id,name:'connect_captcha',value:Date.now().toString(28),type:'hidden'});$(this).append(captcha)}}})}function doc_ready_csrf(){$(document).ajaxComplete(function(event,data,settings){if(settings.url.startsWith('/connect/')===true){if(data.responseJSON!==undefined){if(data.responseJSON.csrf_hash!==undefined){csrf_hash=data.responseJSON.csrf_hash}}}})}$(function(){var dw_connect=$('#dw-connect');if(dw_connect.length){var chat_container=$('#dz-chat');var user_id=chat_container.data('user-id');var group_id=chat_container.data('group-id');doc_ready_tooltips();doc_ready_tag();doc_ready_click();doc_ready_select2();doc_ready_typeahead();doc_ready_masonry()}if(user_id!==undefined){doc_ready_conversations();doc_ready_load_conversations(user_id,false)}else if(group_id!==undefined){doc_ready_conversations();doc_ready_load_groups(group_id,false)}else if($('#dz-groups-loop').length){doc_ready_load_groups(null,true)}else if($('#js-conversations').length){doc_ready_load_conversations(null,true);doc_ready_meet_by_email()}doc_ready_gritter();doc_ready_sidebar();doc_ready_captcha();doc_ready_csrf()});